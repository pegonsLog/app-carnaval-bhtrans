<div class="page-container">
    <div class="page-header">
        <button class="btn-voltar" (click)="voltar()">
            <ng-icon name="heroArrowLeft"></ng-icon>
        </button>
        <h2>Buscar Por Linha</h2>
    </div>

    <div class="page-content">
        <div class="filtros-container">
            <div class="filtro-grupo">
                <label>Linha / Destino</label>
                <input type="text" [(ngModel)]="filtroLinha" (input)="aplicarFiltros()"
                    placeholder="Digite a linha ou PC..." class="input-filtro">
            </div>

            <div class="filtro-grupo">
                <label>Via / Itinerário (Opcional)</label>
                <input type="text" [(ngModel)]="filtroItinerario" (input)="aplicarFiltros()"
                    placeholder="Digite o nome da via..." class="input-filtro">
            </div>

            <div class="resultado-count" *ngIf="linhasFiltradas.length > 0">
                Encontrada(s) <span *ngIf="linhasNormais > 0"><strong class="count-sumob">{{ linhasNormais }}</strong> linha(s) da Sumob</span><span *ngIf="linhasNormais > 0 && linhasMetropolitanas > 0"> e </span><span *ngIf="linhasMetropolitanas > 0"><strong class="count-metropolitana">{{ linhasMetropolitanas }}</strong> linha(s) metropolitana(s)</span>
            </div>
        </div>

        <div class="loading" *ngIf="carregando">
            <div class="spinner"></div>
            <p>Carregando linhas...</p>
        </div>

        <div class="info-metropolitano">
            <span class="info-icon">ℹ</span>
            As linhas com texto em vermelho pertencem ao sistema metropolitano
        </div>

        <div class="lista-linhas" *ngIf="linhasFiltradas.length > 0 && !carregando">
            <div class="linha-card" *ngFor="let linha of linhasFiltradas" [class.expandido]="linhaExpandida === linha.id" [class.linha-metropolitana]="linha.pc.trim() === '-' || !linha.pc">
                <div class="linha-header" (click)="toggleExpansao(linha.id)">
                    <div class="linha-info">
                        <span class="linha-nome">{{ linha.linhaDestino }}</span>
                        <span class="linha-pc">PC: {{ linha.pc || '-' }}</span>
                    </div>
                    <button class="btn-expandir">
                        <ng-icon [name]="linhaExpandida === linha.id ? 'heroXMark' : 'heroEllipsisHorizontal'"></ng-icon>
                    </button>
                </div>
                <div class="linha-detalhes" *ngIf="linhaExpandida === linha.id">
                    <div class="detalhe-item">
                        <span class="detalhe-label">Itinerário</span>
                        <span class="detalhe-valor">{{ linha.itinerario || '-' }}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">PEDs Ativados</span>
                        <span class="detalhe-valor">{{ linha.pedsAtivados || '-' }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="sem-resultados" *ngIf="(filtroLinha || filtroItinerario) && linhasFiltradas.length === 0 && !carregando">
            Nenhuma linha encontrada
        </div>

        <div class="instrucao" *ngIf="!filtroLinha && !filtroItinerario && !carregando">
            Digite o nome ou número da linha, para buscar o desvio.
        </div>
    </div>
</div>
