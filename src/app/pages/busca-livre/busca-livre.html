<div class="page-container">
    <div class="page-header">
        <button class="btn-voltar" (click)="voltar()">
            <ng-icon name="heroArrowLeft"></ng-icon>
        </button>
        <h2>Busca Livre</h2>
    </div>

    <div class="page-content">
        <!-- Indicador de carregamento -->
        <div class="loading-message" *ngIf="isLoading">
            Carregando dados...
        </div>

        <!-- Mensagem de erro -->
        <div class="error-message" *ngIf="errorMessage && !isLoading">
            {{ errorMessage }}
        </div>

        <div class="filtro-grupo">
            <label>Buscar</label>
            <input type="text" [(ngModel)]="termoBusca" (input)="buscar()"
                placeholder="Digite qualquer termo para buscar..." class="input-filtro" autofocus>
        </div>

        <div class="filtro-grupo">
            <label>Regional (opcional)</label>
            <select [(ngModel)]="filtroRegional" (change)="buscar()" class="select-filtro">
                <option value="">Todas as regionais</option>
                <option *ngFor="let regional of regionaisDisponiveis" [value]="regional">{{ regional }}</option>
            </select>
        </div>

        <div class="filtro-grupo">
            <label>Data do Desfile (opcional)</label>
            <select [(ngModel)]="filtroDataDesfile" (change)="buscar()" class="select-filtro">
                <option value="">Todas as datas</option>
                <option *ngFor="let data of datasDesfileDisponiveis" [value]="data">{{ data }} - {{ getDiaSemana(data) }}</option>
            </select>
        </div>

        <button class="btn-limpar" (click)="limparFiltros()" *ngIf="termoBusca || filtroRegional || filtroDataDesfile">
            <ng-icon name="heroXMark"></ng-icon>
            Limpar Filtros
        </button>

        <!-- Contador de resultados -->
        <div class="results-count" *ngIf="(termoBusca || filtroRegional || filtroDataDesfile) && !isLoading">
            <strong>{{ blocosEncontrados.length }}</strong> {{ blocosEncontrados.length === 1 ? 'bloco encontrado' : 'blocos encontrados' }}
        </div>

        <div class="lista-blocos" *ngIf="blocosEncontrados.length > 0">
            <div class="bloco-card" *ngFor="let bloco of blocosEncontrados">
                <div class="bloco-info">
                    <span class="bloco-nome">{{ bloco.nomeDoBloco }}</span>
                    <span class="bloco-regional">{{ bloco.regional }}</span>
                    <span class="bloco-data">{{ formatarDataParaFiltro(bloco.dataDoDesfile) }}</span>
                </div>
                <div class="bloco-acoes">
                    <button class="btn-acao" (click)="verNoMapa(bloco)" [disabled]="!temMapa(bloco)" title="Ver Mapa">
                        <ng-icon name="heroMapPin"></ng-icon>
                    </button>
                    <button class="btn-acao" (click)="verDetalhes(bloco)" title="Ver Detalhes">
                        <ng-icon name="heroEye"></ng-icon>
                    </button>
                </div>
            </div>
        </div>

        <div class="sem-resultados" *ngIf="(termoBusca || filtroRegional || filtroDataDesfile) && blocosEncontrados.length === 0 && !isLoading">
            Nenhum bloco encontrado
        </div>

        <div class="mensagem-inicial" *ngIf="!termoBusca && !filtroRegional && !filtroDataDesfile && !isLoading">
            <ng-icon name="heroMagnifyingGlass"></ng-icon>
            <p>Digite algo ou selecione um filtro para come√ßar a busca</p>
        </div>
    </div>
</div>